{% extends 'layouts/base.html' %}

{% block title %}Thông tin cá nhân{% endblock %}

{% block content %}
<!-- Header-->
<header class="bg-dark py-5">
    <div class="container px-4 px-lg-5 my-5">
        <div class="text-center text-white">
            <h1 class="display-4 fw-bolder">Thông tin cá nhân</h1>
        </div>
    </div>
</header>
<section class="py-5">
    <div class="container px-4 px-lg-5 mt-5">
    <div class="row">
        <div class="col-6">
            <p>Phone Number:</p>
            <input type="text" value="{{ user.phone_number }}" class="form-control" disabled>
            <p>Email:</p>
            <input type="text" value="{{ user.email }}" class="form-control" disabled>
            <p>First Name:</p>
            <input type="text" value="{{ user.first_name }}" class="form-control" disabled>
            <p>Last Name:</p>
            <input type="text" value="{{ user.last_name }}" class="form-control" disabled>
            <p>Address:</p>
            <input type="text" value="{{ user.address }}" class="form-control" disabled>
            <p>Role:</p>
            <input type="text" value="{{ user.role }}" class="form-control" disabled>
        </div>
        <div class = "col-6">
            <p>Avatar:</p>
            <img src="/media/account/avatar-default.svg" alt="Avatar" class="img-fluid" style="width: 200px; height: 200px;">
            <p>Joined Date:</p>
            <input type="text" value="{{ user.date_joined }}" class="form-control" disabled>
            <p>Last Login:</p>
            <input type="text" value="{{ user.last_login }}" class="form-control" disabled>
            <br>
            <a href="/accounts/profile/edit" class="btn btn-dark">Edit</a>
            <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Change Password</button>

            <!-- Change Password Modal -->
            <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Add your change password form here -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-dark" id="change-pwd">Change Password</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</section>
<script>
    $(document).ready(function() {
        $('#changePasswordModal').on('show.bs.modal', function (event) {
            var modal = $(this);
            modal.find('.modal-body').load("{% url 'change-password' %}", function(){
                $("#change-pwd-form input"). each(function() {
                    $(this).addClass('form-control');
                });
            });

            $('#change-pwd').click(function() {
                $.ajaxSetup({
                    headers: { "X-CSRFToken": "{{ csrf_token }}" }
                });

                $.ajax({
                    type: 'POST',
                    url: "{% url 'change-password' %}",
                    data: $('#change-pwd-form').serialize(),
                    success: function(response) {
                        if (response['status'] == 'success') {
                            $("#changepwd-status").html('<div class="alert alert-success" role="alert">Password changed successfully</div>');
                            setTimeout(function() {
                                $('#changePasswordModal').modal('hide');
                            },1000);
                        } else {
                            $("#changepwd-status").html('<div class="alert alert-danger" role="alert">' + response['error_message'] + '</div>');
                        }
                    },
                    error: function(responseText, status, error) {
                        $("#changepwd-status").html('<div class="alert alert-danger" role="alert">' + error + '</div>');
                    }
                });
            });
        });
     });
</script>
{% endblock %}